import torch
from torchmetrics.detection.mean_ap import MeanAveragePrecision
import time 

metric = MeanAveragePrecision()
start_time = time.time()
preds = [
  dict(
    boxes=torch.tensor([[789, 485, 881, 556],
        [466, 481, 521, 500],
        [533, 481, 573, 499],
        [789, 485, 880, 556],
        [781, 454, 836, 470]]),
    scores=torch.tensor([0.5890, 0.4411, 0.4252, 0.3038, 0.2676]),
    labels=torch.tensor([1, 1, 1, 1, 1]),
  ), 
  dict(
    boxes=torch.tensor([[789, 485, 881, 556],
        [466, 481, 521, 500],
        [533, 481, 573, 499],
        [789, 485, 880, 556],
        [781, 454, 836, 470]]),
    scores=torch.tensor([0.5890, 0.4411, 0.4252, 0.3038, 0.2676]),
    labels=torch.tensor([1, 1, 1, 1, 1]),
  ), 
  dict(
    boxes=torch.tensor([[789, 485, 881, 556],
        [466, 481, 521, 500],
        [533, 481, 573, 499],
        [789, 485, 880, 556],
        [781, 454, 836, 470]]),
    scores=torch.tensor([0.5890, 0.4411, 0.4252, 0.3038, 0.2676]),
    labels=torch.tensor([1, 1, 1, 1, 1]),
  )
]
target = [
  dict(
    boxes=torch.tensor([[398, 467, 433, 483,   ], 
      [537, 464, 575, 480,   ], 
      [770, 456, 807, 471,   ], 
      [619, 461, 661, 477,   ], 
      [532, 479, 579, 498,   ], 
      [356, 468, 395, 483,   ],
      [1044,  465, 1103,  489], 
      [320, 471, 356, 486,   ], 
      [466, 480, 521, 499,   ], 
      [676, 460, 712, 475,   ],
      [796, 454, 835, 471,   ]]),
    labels=torch.tensor([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]),
  ), 
  dict(
    boxes=torch.tensor([[398, 467, 433, 483,   ], 
      [537, 464, 575, 480,   ], 
      [770, 456, 807, 471,   ], 
      [619, 461, 661, 477,   ], 
      [532, 479, 579, 498,   ], 
      [356, 468, 395, 483,   ],
      [1044,  465, 1103,  489], 
      [320, 471, 356, 486,   ], 
      [466, 480, 521, 499,   ], 
      [676, 460, 712, 475,   ],
      [796, 454, 835, 471,   ]]),
    labels=torch.tensor([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]),
  ), 
  dict(
    boxes=torch.tensor([[398, 467, 433, 483,   ], 
      [537, 464, 575, 480,   ], 
      [770, 456, 807, 471,   ], 
      [619, 461, 661, 477,   ], 
      [532, 479, 579, 498,   ], 
      [356, 468, 395, 483,   ],
      [1044,  465, 1103,  489], 
      [320, 471, 356, 486,   ], 
      [466, 480, 521, 499,   ], 
      [676, 460, 712, 475,   ],
      [796, 454, 835, 471,   ]]),
    labels=torch.tensor([1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1]),
  )
]

metric.update(preds, target)
from pprint import pprint
pprint(metric.compute())
print(time.time() - start_time)

